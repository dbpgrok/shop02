<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<!-- üîí CSP renforc√© : self + raw GH + blob/data pour audio/images -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https://raw.githubusercontent.com data: blob:; media-src 'self' https://raw.githubusercontent.com blob: data:; script-src 'self'; style-src 'self' 'unsafe-inline';">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<title>Shop02 - Boutique Musique S√©curis√©e Pr√©-30s PRO</title>
<style>
/* Styles inchang√©s pour brevit√© - copiez de votre version */
body{font-family:'Arial',sans-serif;background:linear-gradient(135deg,#f4f4f4,#e8e8e8);margin:0;padding:20px;max-width:1200px;margin:auto;box-sizing:border-box;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;}
header{background:linear-gradient(135deg,#2c3e50,#34495e);color:white;text-align:center;padding:2.5rem 2rem;border-radius:20px;box-shadow:0 10px 30px rgba(44,62,80,0.3);margin-bottom:2rem;}
h1{font-size:2.5rem;margin:0;font-weight:300;text-shadow:0 2px 10px rgba(0,0,0,0.3);}
.subtitle{font-size:1.2rem;margin:0.5rem 0;opacity:0.9;}
.track{background:linear-gradient(135deg,#cd7f32,#b8860b);padding:25px;margin:20px 0;border-radius:20px;box-shadow:0 10px 30px rgba(205,127,50,0.4);display:grid;grid-template-columns:250px 1fr auto auto;gap:20px;align-items:center;transition:all 0.3s ease;}
.track:hover{transform:translateY(-8px);box-shadow:0 15px 40px rgba(205,127,50,0.6);}
.track.active{box-shadow:0 20px 50px rgba(205,127,50,0.8);transform:translateY(-12px);}
.cover{width:250px;height:250px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.3);object-fit:cover;loading:lazy;}
.title{font-size:1.4rem;font-weight:bold;color:white;text-shadow:0 2px 5px rgba(0,0,0,0.5);margin:0;}
.artist{font-size:1rem;color:#f4e8c1;opacity:0.9;margin:0 0 10px 0;}
.price{color:#ffd700;font-size:1.3rem;font-weight:bold;text-shadow:0 1px 3px rgba(0,0,0,0.3);}
audio{width:100%;height:50px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.2);background:#fff;}
.loading{text-align:center;color:#f4e8c1;font-style:italic;}
.btn{padding:12px 25px;background:linear-gradient(45deg,#27ae60,#2ecc71);color:white;border:none;border-radius:25px;cursor:pointer;font-weight:bold;font-size:1rem;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(39,174,96,0.4);}
.btn:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(39,174,96,0.6);}
.buy{background:linear-gradient(45deg,#e74c3c,#c0392b);box-shadow:0 4px 15px rgba(231,76,60,0.4);}
.buy:hover{box-shadow:0 8px 25px rgba(231,76,60,0.6);}
.play-btn{background:linear-gradient(45deg,#3498db,#2980b9);margin-right:10px;}
.play-btn.active{background:linear-gradient(45deg,#e67e22,#d35400) !important;box-shadow:0 6px 20px rgba(230,126,34,0.6) !important;}
@media (max-width:600px){.track{grid-template-columns:250px 1fr;grid-template-rows:auto auto;text-align:center;}.cover{margin:0 auto 15px auto;}}
@media (max-width:300px){.track{grid-template-columns:1fr;}.cover{width:200px;height:200px;}}
</style>
</head>
<body>
<header>
<h1>üéµ Shop02 Boutique Musique</h1>
<p class="subtitle">Pr√©-√©coutez 30 secondes en haute qualit√© ‚Ä¢ Achetez instantan√©ment ‚Ä¢ üîí Ultra-s√©curis√©<br><small>üéß Un seul lecteur √† la fois ‚Ä¢ Images optimis√©es & s√©curis√©es</small></p>
</header>
<main>
<!-- Tracks identiques √† votre version, mais audio-container visible sur play -->
<!-- Exemple pour Track 1 - R√©p√©tez pour 2-6 avec IDs incr√©ment√©s -->
<div class="track" data-track="1">
<img src="https://raw.githubusercontent.com/dbpgrok/shop02/main/assets/0001.jpg" alt="Cover Hamsterrad Revolte" class="cover" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUwIiBoZWlnaHQ9IjI1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2RjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNvdmVyPC90ZXh0Pjwvc3ZnPg=='">
<div>
<h2 class="title">Hamsterrad Revolte</h2>
<p class="artist">AI101MUSIC ‚Ä¢ Single 2026</p>
</div>
<div id="audio-container1">
    <div class="loading" id="loading1">üîÑ Chargement s√©curis√© de la pr√©-√©coute...</div>
    <audio id="audio1" controls preload="none" controlsList="nodownload noremoteplayback nopicture-in-picture" style="width:350px;display:none;">
        Votre navigateur ne supporte pas l'audio.
    </audio>
</div>
<div class="price">‚Ç¨0.79</div>
<button class="btn play-btn" id="playBtn1" onclick="playPreview('1')">‚ñ∂Ô∏è √âcouter 30s</button>
<button class="btn buy" onclick="buy('Hamsterrad Revolte')">üí≥ Acheter</button>
</div>
<!-- R√©p√©tez pour tracks 2-6 en changeant IDs/noms/files -->
</main>
<script>
let audioBlobs = {}; 
let currentPlayingTrack = null;
const mp3Files = {
  '1': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/Hamsterrad-Revolte.mp3',
  '2': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/Self Care Groove.mp3',
  '3': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/The Hope Wins.mp3',
  '4': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/trk3.mp3',
  '5': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/Sebene2.mp3',
  '6': 'https://raw.githubusercontent.com/dbpgrok/shop02/main/Al Dogma.mp3'
};

// üõë Arr√™te tous les autres + reset visuel
function stopAllOthers(newTrackId) {
  for(let i=1; i<=6; i++) {
    if(i.toString() !== newTrackId) {
      const audio = document.getElementById(`audio${i}`);
      const trackDiv = document.querySelector(`[data-track="${i}"]`);
      const playBtn = document.getElementById(`playBtn${i}`);
      const loading = document.getElementById(`loading${i}`);
      if(audio) {
        audio.pause();
        audio.currentTime = 0;
        audio.style.display = 'none';
      }
      if(trackDiv) trackDiv.classList.remove('active');
      if(playBtn) playBtn.classList.remove('active');
      if(loading) loading.style.display = 'block';
    }
  }
}

// ‚ñ∂Ô∏è Pr√©-√©coute 30s s√©curis√©e
async function playPreview(trackId) {
  stopAllOthers(trackId);
  const audio = document.getElementById(`audio${trackId}`);
  const container = document.getElementById(`audio-container${trackId}`);
  const loading = document.getElementById(`loading${trackId}`);
  const trackDiv = document.querySelector(`[data-track="${trackId}"]`);
  const playBtn = document.getElementById(`playBtn${trackId}`);

  if (!audio.src || audio.src !== audioBlobs[trackId]) {
    loading.style.display = 'block';
    try {
      const response = await fetch(mp3Files[trackId]);
      if (!response.ok) throw new Error('Fichier non trouv√©');
      const blob = await response.blob();
      audioBlobs[trackId] = URL.createObjectURL(blob);
      audio.src = audioBlobs[trackId];
    } catch (e) {
      loading.textContent = '‚ùå Erreur chargement audio';
      return;
    }
  }

  loading.style.display = 'none';
  audio.style.display = 'block';
  audio.currentTime = 0;
  audio.play();
  trackDiv.classList.add('active');
  playBtn.classList.add('active');
  currentPlayingTrack = trackId;

  // ‚èπ Stop apr√®s 30s
  setTimeout(() => {
    if (currentPlayingTrack === trackId) {
      audio.pause();
      audio.currentTime = 0;
      audio.style.display = 'none';
      trackDiv.classList.remove('active');
      playBtn.classList.remove('active');
      currentPlayingTrack = null;
    }
  }, 30000);
}

// üí≥ Achat simul√© (remplacez par API Stripe/PayPal + backend s√©curis√©)
function buy(trackName) {
  if (confirm(`Acheter "${trackName}" pour ‚Ç¨0.79 ?`)) {
    // üîí Ici : POST vers /buy avec token CSRF + validation
    alert(`‚úÖ Achat "${trackName}" confirm√© ! T√©l√©chargement envoy√© par email.`);
    // window.location.href = `/download/${encodeURIComponent(trackName)}.mp3?token=SECURE_TOKEN`;
  }
}
</script>
</body>
</html>
